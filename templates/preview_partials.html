{# ======= PREVIEW RENDERING PARTIALS ======= #}

{# Steel Profile Preview #}
{% macro steel_preview(result) %}
<div class="profile-properties">
    <div class="property-item">
        <span class="property-label">Flange:</span>
        <span class="property-value">
            {% if result.lambda_f < result.lambda_p_f %}Compact <span class="status-icon pass">✓</span>
            {% elif result.lambda_f > result.lambda_p_f and result.lambda_f < result.lambda_r_f %}Non-compact <span class="status-icon fail">✕</span>
            {% else %}Slender <span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">Web:</span>
        <span class="property-value">
            {% if result.lambda_w < result.lambda_p_w %}Compact <span class="status-icon pass">✓</span>
            {% elif result.lambda_w > result.lambda_p_w and result.lambda_w < result.lambda_r_w %}Non-compact <span class="status-icon fail">✕</span>
            {% else %}Slender <span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">Area:</span>
        <span class="property-value">{{ result.area }} mm²</span>
    </div>
    <div class="property-item">
        <span class="property-label">I<sub>xx</sub>:</span>
        <span class="property-value">{{ result.I_xx }} mm⁴</span>
    </div>
    <div class="property-item">
        <span class="property-label">I<sub>yy</sub>:</span>
        <span class="property-value">{{ result.I_yy }} mm⁴</span>
    </div>
    <div class="property-item">
        <span class="property-label">Z<sub>x</sub>:</span>
        <span class="property-value">{{ result.Z_x }} mm³</span>
    </div>
    <div class="property-item">
        <span class="property-label">M<sub>n</sub>:</span>
        <span class="property-value">{{ result.Mn }} kN-m</span>
    </div>
    <div class="property-item">
        <span class="property-label">φM<sub>n</sub>:</span>
        <span class="property-value">{{ result.phi_Mn }} kN-m</span>
    </div>
</div>
{% endmacro %}

{# Aluminum Profile Preview #}
{% macro alum_preview(result) %}
<div class="profile-properties">
    <div class="property-item">
        <span class="property-label">Area:</span>
        <span class="property-value">{{ result.area }} mm²</span>
    </div>
    <div class="property-item">
        <span class="property-label">I<sub>xx</sub>:</span>
        <span class="property-value">{{ result.I_xx }} mm⁴</span>
    </div>
    <div class="property-item">
        <span class="property-label">I<sub>yy</sub>:</span>
        <span class="property-value">{{ result.I_yy }} mm⁴</span>
    </div>
    <div class="property-item">
        <span class="property-label">S<sub>x</sub>:</span>
        <span class="property-value">{{ result.S_x }} mm³</span>
    </div>
    <div class="property-item">
        <span class="property-label">Z<sub>x</sub>:</span>
        <span class="property-value">{{ result.Z_x }} mm³</span>
    </div>
    <div class="property-item">
        <span class="property-label">φM<sub>n</sub>:</span>
        <span class="property-value">{{ result.phi_Mn or '—' }} kN-m</span>
    </div>
</div>
{% endmacro %}

{# Glass Unit Preview #}
{% macro glass_preview(result, glass_type) %}
{% if glass_type == "sgu" or glass_type == "lgu" %}
<div class="profile-properties">
    <div class="property-item">
        <span class="property-label">Eff. Area:</span>
        <span class="property-value">{{ result.A_eff or '—' }} mm²</span>
    </div>
    <div class="property-item">
        <span class="property-label">Aspect Ratio:</span>
        <span class="property-value">{{ result.aspect_ratio or '—' }}</span>
    </div>
    <div class="property-item">
        <span class="property-label">GTF:</span>
        <span class="property-value">{{ result.gtf or '—' }}</span>
    </div>
    <div class="property-item">
        <span class="property-label">LR:</span>
        <span class="property-value">
            {% if glass_type == "sgu" %}
                {{ result.sgu_lr or '—' }} kPa
            {% elif glass_type == "lgu" %}
                {{ result.lgu_lr or '—' }} kPa
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">Stress Ratio:</span>
        <span class="property-value">{{ result.stress_ratio or '—' }}
            {% if result.stress_ratio and result.stress_ratio <= 1 %}<span class="status-icon pass">✓</span>
            {% elif result.stress_ratio %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">Allow. Def:</span>
        <span class="property-value">{{ result.allow_def or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">Defl. Ratio:</span>
        <span class="property-value">{{ result.def_ratio or '—' }}
            {% if result.def_ratio and result.def_ratio <= 1 %}<span class="status-icon pass">✓</span>
            {% elif result.def_ratio %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
</div>

{% elif glass_type == "dgu" or glass_type == "ldgu" %}
<div class="profile-properties">
    <div class="property-item">
        <span class="property-label">Eff. Area:</span>
        <span class="property-value">{{ result.A_eff or '—' }} mm²</span>
    </div>
    <div class="property-item">
        <span class="property-label">Aspect Ratio:</span>
        <span class="property-value">{{ result.aspect_ratio or '—' }}</span>
    </div>
    <div class="property-item">
        <span class="property-label">GTF<sub>1</sub>:</span>
        <span class="property-value">{{ result.gtf1 or '—' }}</span>
    </div>
    <div class="property-item">
        <span class="property-label">GTF<sub>2</sub>:</span>
        <span class="property-value">{{ result.gtf2 or '—' }}</span>
    </div>
    <div class="property-item">
        <span class="property-label">LS<sub>1</sub>:</span>
        <span class="property-value">
            {% if glass_type == "dgu" %}
                {{ result.dgu_ls1 or '—' }}
            {% elif glass_type == "ldgu" %}
                {{ result.ldgu_ls1 or '—' }}
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">LS<sub>2</sub>:</span>
        <span class="property-value">
            {% if glass_type == "dgu" %}
                {{ result.dgu_ls2 or '—' }}
            {% elif glass_type == "ldgu" %}
                {{ result.ldgu_ls2 or '—' }}
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">LR<sub>1</sub>:</span>
        <span class="property-value">
            {% if glass_type == "dgu" %}
                {{ result.dgu_lr1 or '—' }} kPa
            {% elif glass_type == "ldgu" %}
                {{ result.ldgu_lr1 or '—' }} kPa
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">LR<sub>2</sub>:</span>
        <span class="property-value">
            {% if glass_type == "dgu" %}
                {{ result.dgu_lr2 or '—' }} kPa
            {% elif glass_type == "ldgu" %}
                {{ result.ldgu_lr2 or '—' }} kPa
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">Stress Ratio:</span>
        <span class="property-value">{{ result.stress_ratio or '—' }}
            {% if result.stress_ratio and result.stress_ratio <= 1 %}<span class="status-icon pass">✓</span>
            {% elif result.stress_ratio %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">Allow. Def:</span>
        <span class="property-value">{{ result.allow_def or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">Defl. Ratio:</span>
        <span class="property-value">{{ result.def_ratio or '—' }}
            {% if result.def_ratio and result.def_ratio <= 1 %}<span class="status-icon pass">✓</span>
            {% elif result.def_ratio %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
</div>
{% endif %}
{% endmacro %}

{# Frame Preview #}
{% macro frame_preview(result) %}
<div class="profile-properties">
    <div class="property-item">
        <span class="property-label">Eff. Area:</span>
        <span class="property-value">{{ result.eff_area or '—' }} m²</span>
    </div>
    <div class="property-item">
        <span class="property-label">Glass DL:</span>
        <span class="property-value">{{ result.glass_sw or '—' }} kPa</span>
    </div>
    
    <div class="property-break">Mullion</div>
    {% if result.mullion_type == "Aluminum + Steel" %}
    <div class="property-item">
        <span class="property-label">I<sub>xa</sub>:</span>
        <span class="property-value">{{ result.I_xa or '—' }} mm⁴</span>
    </div>
    <div class="property-item">
        <span class="property-label">I<sub>xs</sub>:</span>
        <span class="property-value">{{ result.I_xs or '—' }} mm⁴</span>
    </div>
    <div class="property-item">
        <span class="property-label">LS<sub>a</sub>:</span>
        <span class="property-value">{{ result.ls_a or '—' }}</span>
    </div>
    <div class="property-item">
        <span class="property-label">LS<sub>s</sub>:</span>
        <span class="property-value">{{ result.ls_s or '—' }}</span>
    </div>
    {% endif %}
    
    <div class="property-item">
        <span class="property-label">Mullion M<sub>u</sub>:</span>
        <span class="property-value">{{ result.mul_mu or '—' }} kNm</span>
    </div>
    
    {% if result.mullion_type == "Aluminum + Steel" %}
    <div class="property-item">
        <span class="property-label">Alum. φM<sub>n</sub>:</span>
        <span class="property-value">{{ result.mul_phi_Mn_a or '—' }} kN-m</span>
    </div>
    <div class="property-item">
        <span class="property-label">Alum. D/C:</span>
        <span class="property-value">{{ result.mul_dc_a or '—' }}
            {% if result.mul_dc_a and result.mul_dc_a <= 1 %}<span class="status-icon pass">✓</span>
            {% elif result.mul_dc_a %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">Steel φM<sub>n</sub>:</span>
        <span class="property-value">{{ result.mul_phi_Mn_s or '—' }} kN-m</span>
    </div>
    <div class="property-item">
        <span class="property-label">Steel D/C:</span>
        <span class="property-value">{{ result.mul_dc_s or '—' }}
            {% if result.mul_dc_s and result.mul_dc_s <= 1 %}<span class="status-icon pass">✓</span>
            {% elif result.mul_dc_s %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    {% else %}
    <div class="property-item">
        <span class="property-label">Mullion φM<sub>n</sub>:</span>
        <span class="property-value">{{ result.mul_phi_Mn or '—' }} kN-m</span>
    </div>
    <div class="property-item">
        <span class="property-label">Mullion D/C:</span>
        <span class="property-value">{{ result.mul_dc or '—' }}
            {% if result.mul_dc and result.mul_dc <= 1 %}<span class="status-icon pass">✓</span>
            {% elif result.mul_dc %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    {% endif %}
    
    <div class="property-item">
        <span class="property-label">Mullion Defl:</span>
        <span class="property-value">{{ result.mul_def or '—' }} mm
            {% if result.mul_def and result.mul_def <= result.mul_allow_def %}<span class="status-icon pass">✓</span>
            {% elif result.mul_def %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">Mul. Allow. Defl:</span>
        <span class="property-value">{{ result.mul_allow_def or '—' }} mm</span>
    </div>
    
    <div class="property-break">Transom</div>
    <div class="property-item">
        <span class="property-label">Transom M<sub>u</sub>:</span>
        <span class="property-value">{{ result.tran_mu or '—' }} kNm</span>
    </div>
    <div class="property-item">
        <span class="property-label">Transom φM<sub>n</sub>:</span>
        <span class="property-value">{{ result.tran_phi_Mn or '—' }} kN-m</span>
    </div>
    <div class="property-item">
        <span class="property-label">Transom D/C:</span>
        <span class="property-value">{{ result.tran_dc or '—' }}
            {% if result.tran_dc and result.tran_dc <= 1 %}<span class="status-icon pass">✓</span>
            {% elif result.tran_dc %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">Tran. Wind Defl:</span>
        <span class="property-value">{{ result.tran_def_wind or '—' }} mm
            {% if result.tran_def_wind and result.tran_def_wind <= result.tran_allow_def %}<span class="status-icon pass">✓</span>
            {% elif result.tran_def_wind %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">Tran. Dead Defl:</span>
        <span class="property-value">{{ result.tran_def_dead or '—' }} mm
            {% if result.tran_def_dead and result.tran_def_dead <= 3.0 %}<span class="status-icon pass">✓</span>
            {% elif result.tran_def_dead %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">Tran. Allow. Defl:</span>
        <span class="property-value">{{ result.tran_allow_def or '—' }} mm</span>
    </div>
</div>
{% endmacro %}

{# Connection Preview #}
{% macro connection_preview(result) %}
<div class="profile-properties">
    <div class="property-item">
        <span class="property-label">Joint f<sub>y</sub>:</span>
        <span class="property-value">{{ result.joint_fy or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">Joint f<sub>z</sub>:</span>
        <span class="property-value">{{ result.joint_fz or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">Shear, R<sub>yA</sub>:</span>
        <span class="property-value">{{ result.R_yA or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">Tension, R<sub>zA</sub>:</span>
        <span class="property-value">{{ result.R_zA or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">Resultant, V<sub>u</sub>:</span>
        <span class="property-value">{{ result.Vu or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">Shear, φP<sub>nv</sub>:</span>
        <span class="property-value">{{ result.phi_Pnv or '—' }} kN
            {% if result.phi_Pnv and result.phi_Pnv > result.Vu %}<span class="status-icon pass">✓</span>
            {% elif result.phi_Pnv %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">Pullout, φP<sub>not</sub>:</span>
        <span class="property-value">{{ result.phi_Pnot or '—' }} kN
            {% if result.phi_Pnot and result.phi_Pnot > result.R_zA %}<span class="status-icon pass">✓</span>
            {% elif result.phi_Pnot %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">Pullover, φP<sub>nov</sub>:</span>
        <span class="property-value">{{ result.phi_Pnov or '—' }} kN
            {% if result.phi_Pnov and result.phi_Pnov > result.R_zA %}<span class="status-icon pass">✓</span>
            {% elif result.phi_Pnov %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">β<sub>pullover</sub>:</span>
        <span class="property-value">{{ result.beta_pullover or '—' }}
            {% if result.beta_pullover and result.beta_pullover <= 0.715 %}<span class="status-icon pass">✓</span>
            {% elif result.beta_pullover %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">β<sub>pullout</sub>:</span>
        <span class="property-value">{{ result.beta_pullout or '—' }}
            {% if result.beta_pullout and result.beta_pullout <= 0.69 %}<span class="status-icon pass">✓</span>
            {% elif result.beta_pullout %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
</div>
{% endmacro %}

{# Anchorage Preview #}
{% macro anchorage_preview(result) %}
<div class="profile-properties">
    <div class="property-item">
        <span class="property-label">Reaction R<sub>y</sub>:</span>
        <span class="property-value">{{ result.reaction_Ry or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">Reaction R<sub>z</sub>:</span>
        <span class="property-value">{{ result.reaction_Rz or '—' }} kN</span>
    </div>

{% if result.clump_type == "Box Clump" %}
    <div class="property-break">Anchor</div>
    <div class="property-item">
        <span class="property-label">V<sub>ua</sub>:</span>
        <span class="property-value">{{ result.V_ua or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">V<sub>ug</sub>:</span>
        <span class="property-value">{{ result.V_ug or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">φV<sub>sa</sub>:</span>
        <span class="property-value">{{ result.phi_Vsa or '—' }} kN
            {% if result.phi_Vsa and result.phi_Vsa > result.V_ua %}<span class="status-icon pass">✓</span>
            {% elif result.phi_Vsa %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">A<sub>VC</sub>:</span>
        <span class="property-value">{{ result.A_VC or '—' }} mm²</span>
    </div>
    <div class="property-item">
        <span class="property-label">A<sub>VCO</sub>:</span>
        <span class="property-value">{{ result.A_VCO or '—' }} mm²</span>
    </div>
    <div class="property-item">
        <span class="property-label">φV<sub>cbg</sub>:</span>
        <span class="property-value">{{ result.phi_Vcbg or '—' }} kN
            {% if result.phi_Vcbg and result.phi_Vcbg > result.V_ug %}<span class="status-icon pass">✓</span>
            {% elif result.phi_Vcbg %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">φV<sub>cp</sub>:</span>
        <span class="property-value">{{ result.phi_Vcp or '—' }} kN
            {% if result.phi_Vcp and result.phi_Vcp > result.V_ug %}<span class="status-icon pass">✓</span>
            {% elif result.phi_Vcp %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>

    <div class="property-break">Base plate</div>
    <div class="property-item">
        <span class="property-label">Length:</span>
        <span class="property-value">{{ result.bp_length or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">Width:</span>
        <span class="property-value">{{ result.bp_width or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">P<sub>u</sub>:</span>
        <span class="property-value">{{ result.bp_Pu or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">d:</span>
        <span class="property-value">{{ result.bp_d or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">b:</span>
        <span class="property-value">{{ result.bp_b or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">m:</span>
        <span class="property-value">{{ result.bp_m or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">n:</span>
        <span class="property-value">{{ result.bp_n or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">t<sub>req</sub> (Bearing):</span>
        <span class="property-value">{{ result.bp_t_req_bear or '—' }} mm
            {% if result.bp_t_req_bear and result.bp_t_req_bear < result.bp_thk %}<span class="status-icon pass">✓</span>
            {% elif result.bp_t_req_bear %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>

{% elif result.clump_type == "U Clump" %}
    <div class="property-break">Anchor</div>
    <div class="property-item">
        <span class="property-label">N<sub>ua</sub>:</span>
        <span class="property-value">{{ result.N_ua or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">N<sub>ug</sub>:</span>
        <span class="property-value">{{ result.N_ug or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">V<sub>ua</sub>:</span>
        <span class="property-value">{{ result.V_ua or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">V<sub>ug</sub>:</span>
        <span class="property-value">{{ result.V_ug or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">φN<sub>sa</sub>:</span>
        <span class="property-value">{{ result.phi_Nsa or '—' }} kN
            {% if result.phi_Nsa and result.phi_Nsa > result.N_ua %}<span class="status-icon pass">✓</span>
            {% elif result.phi_Nsa %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">A<sub>NC</sub>:</span>
        <span class="property-value">{{ result.A_NC or '—' }} mm²</span>
    </div>
    <div class="property-item">
        <span class="property-label">A<sub>NCO</sub>:</span>
        <span class="property-value">{{ result.A_NCO or '—' }} mm²</span>
    </div>
    <div class="property-item">
        <span class="property-label">φN<sub>cbg</sub>:</span>
        <span class="property-value">{{ result.phi_Ncbg or '—' }} kN
            {% if result.phi_Ncbg and result.phi_Ncbg > result.N_ug %}<span class="status-icon pass">✓</span>
            {% elif result.phi_Ncbg %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">φN<sub>pn</sub>:</span>
        <span class="property-value">{{ result.phi_Npn or '—' }} kN
            {% if result.phi_Npn and result.phi_Npn > result.N_ua %}<span class="status-icon pass">✓</span>
            {% elif result.phi_Npn %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">φV<sub>sa</sub>:</span>
        <span class="property-value">{{ result.phi_Vsa or '—' }} kN
            {% if result.phi_Vsa and result.phi_Vsa > result.V_ua %}<span class="status-icon pass">✓</span>
            {% elif result.phi_Vsa %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">A<sub>VC</sub>:</span>
        <span class="property-value">{{ result.A_VC or '—' }} mm²</span>
    </div>
    <div class="property-item">
        <span class="property-label">A<sub>VCO</sub>:</span>
        <span class="property-value">{{ result.A_VCO or '—' }} mm²</span>
    </div>
    <div class="property-item">
        <span class="property-label">φV<sub>cbg</sub>:</span>
        <span class="property-value">{{ result.phi_Vcbg or '—' }} kN
            {% if result.phi_Vcbg and result.phi_Vcbg > result.V_ug %}<span class="status-icon pass">✓</span>
            {% elif result.phi_Vcbg %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">φV<sub>cp</sub>:</span>
        <span class="property-value">{{ result.phi_Vcp or '—' }} kN
            {% if result.phi_Vcp and result.phi_Vcp > result.V_ug %}<span class="status-icon pass">✓</span>
            {% elif result.phi_Vcp %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">Interaction:</span>
        <span class="property-value">{{ result.interaction or '—' }}
            {% if result.beta_N < 0.2 or result.beta_V < 0.2 %}
                {% if result.interaction and result.interaction < 1.0 %}<span class="status-icon pass">✓</span>
                {% elif result.interaction %}<span class="status-icon fail">✕</span>
                {% endif %}
            {% else %}
                {% if result.interaction and result.interaction < 1.2 %}<span class="status-icon pass">✓</span>
                {% elif result.interaction %}<span class="status-icon fail">✕</span>
                {% endif %}
            {% endif %}
        </span>
    </div>

    <div class="property-break">Through bolt</div>
    <div class="property-item">
        <span class="property-label">V<sub>u</sub>:</span>
        <span class="property-value">{{ result.bolt_Vu or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">φR<sub>n</sub> (Shear):</span>
        <span class="property-value">{{ result.bolt_phi_Rn_shear or '—' }} kN
            {% if result.bolt_phi_Rn_shear and result.bolt_phi_Rn_shear > result.bolt_Vu %}<span class="status-icon pass">✓</span>
            {% elif result.bolt_phi_Rn_shear %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">φR<sub>n</sub> (Bearing):</span>
        <span class="property-value">{{ result.bolt_phi_Rn_bear or '—' }} kN
            {% if result.bolt_phi_Rn_bear and result.bolt_phi_Rn_bear > result.bolt_Vu %}<span class="status-icon pass">✓</span>
            {% elif result.bolt_phi_Rn_bear %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>

    <div class="property-break">Fin plate</div>
    <div class="property-item">
        <span class="property-label">V<sub>u</sub>:</span>
        <span class="property-value">{{ result.fin_Vu or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">t<sub>req</sub>:</span>
        <span class="property-value">{{ result.fin_t_req or '—' }} mm
            {% if result.fin_t_req and result.fin_t_req < result.fin_thk %}<span class="status-icon pass">✓</span>
            {% elif result.fin_t_req %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">φR<sub>n</sub> (Shear yield):</span>
        <span class="property-value">{{ result.fin_phi_Rn_yield or '—' }} kN
            {% if result.fin_phi_Rn_yield and result.fin_phi_Rn_yield > result.fin_Vu %}<span class="status-icon pass">✓</span>
            {% elif result.fin_phi_Rn_yield %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">φR<sub>n</sub> (Shear rupture):</span>
        <span class="property-value">{{ result.fin_phi_Rn_rupture or '—' }} kN
            {% if result.fin_phi_Rn_rupture and result.fin_phi_Rn_rupture > result.fin_Vu %}<span class="status-icon pass">✓</span>
            {% elif result.fin_phi_Rn_rupture %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">φR<sub>n</sub> (Block shear):</span>
        <span class="property-value">{{ result.fin_phi_Rn_block or '—' }} kN
            {% if result.fin_phi_Rn_block and result.fin_phi_Rn_block > result.fin_Vu %}<span class="status-icon pass">✓</span>
            {% elif result.fin_phi_Rn_block %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>

    <div class="property-break">Weld</div>
    <div class="property-item">
        <span class="property-label">Tensile f<sub>n</sub>:</span>
        <span class="property-value">{{ result.weld_fn or '—' }} N/mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">Shear f<sub>v</sub>:</span>
        <span class="property-value">{{ result.weld_fv or '—' }} N/mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">Bending f<sub>b</sub>:</span>
        <span class="property-value">{{ result.weld_fb or '—' }} N/mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">Resultant, f<sub>R</sub>:</span>
        <span class="property-value">{{ result.weld_fR or '—' }} N/mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">φR<sub>n</sub>:</span>
        <span class="property-value">{{ result.weld_phi_Rn or '—' }} N/mm
            {% if result.weld_phi_Rn and result.weld_phi_Rn > result.weld_fR %}<span class="status-icon pass">✓</span>
            {% elif result.weld_phi_Rn %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>

    <div class="property-break">Base plate</div>
    <div class="property-item">
        <span class="property-label">Length:</span>
        <span class="property-value">{{ result.bp_length or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">Width:</span>
        <span class="property-value">{{ result.bp_width or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">P<sub>u</sub>:</span>
        <span class="property-value">{{ result.bp_Pu or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">d:</span>
        <span class="property-value">{{ result.bp_d or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">b:</span>
        <span class="property-value">{{ result.bp_b or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">m:</span>
        <span class="property-value">{{ result.bp_m or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">n:</span>
        <span class="property-value">{{ result.bp_n or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">t<sub>req</sub> (Bearing):</span>
        <span class="property-value">{{ result.bp_t_req_bear or '—' }} mm
            {% if result.bp_t_req_bear and result.bp_t_req_bear < result.bp_thk %}<span class="status-icon pass">✓</span>
            {% elif result.bp_t_req_bear %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">T<sub>u</sub>:</span>
        <span class="property-value">{{ result.bp_Tu or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">x:</span>
        <span class="property-value">{{ result.bp_x or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">B<sub>eff</sub>:</span>
        <span class="property-value">{{ result.bp_Beff or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">t<sub>req</sub> (Tension):</span>
        <span class="property-value">{{ result.bp_t_req_tension or '—' }} mm
            {% if result.bp_t_req_tension and result.bp_t_req_tension < result.bp_thk %}<span class="status-icon pass">✓</span>
            {% elif result.bp_t_req_tension %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>

{% elif result.clump_type == "L Clump" %}
    <div class="property-break">Top anchor</div>
    <div class="property-item">
        <span class="property-label">V<sub>ua</sub>:</span>
        <span class="property-value">{{ result.top_V_ua or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">V<sub>ug</sub>:</span>
        <span class="property-value">{{ result.top_V_ug or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">φV<sub>sa</sub>:</span>
        <span class="property-value">{{ result.top_phi_Vsa or '—' }} kN
            {% if result.top_phi_Vsa and result.top_phi_Vsa > result.top_V_ua %}<span class="status-icon pass">✓</span>
            {% elif result.top_phi_Vsa %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">A<sub>VC</sub>:</span>
        <span class="property-value">{{ result.top_A_VC or '—' }} mm²</span>
    </div>
    <div class="property-item">
        <span class="property-label">A<sub>VCO</sub>:</span>
        <span class="property-value">{{ result.top_A_VCO or '—' }} mm²</span>
    </div>
    <div class="property-item">
        <span class="property-label">φV<sub>cbg</sub>:</span>
        <span class="property-value">{{ result.top_phi_Vcbg or '—' }} kN
            {% if result.top_phi_Vcbg and result.top_phi_Vcbg > result.top_V_ug %}<span class="status-icon pass">✓</span>
            {% elif result.top_phi_Vcbg %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">φV<sub>cp</sub>:</span>
        <span class="property-value">{{ result.top_phi_Vcp or '—' }} kN
            {% if result.top_phi_Vcp and result.top_phi_Vcp > result.top_V_ug %}<span class="status-icon pass">✓</span>
            {% elif result.top_phi_Vcp %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>

    <div class="property-break">Front anchor</div>
    <div class="property-item">
        <span class="property-label">N<sub>ua</sub>:</span>
        <span class="property-value">{{ result.front_N_ua or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">N<sub>ug</sub>:</span>
        <span class="property-value">{{ result.front_N_ug or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">V<sub>ua</sub>:</span>
        <span class="property-value">{{ result.front_V_ua or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">V<sub>ug</sub>:</span>
        <span class="property-value">{{ result.front_V_ug or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">φN<sub>sa</sub>:</span>
        <span class="property-value">{{ result.front_phi_Nsa or '—' }} kN
            {% if result.front_phi_Nsa and result.front_phi_Nsa > result.front_N_ua %}<span class="status-icon pass">✓</span>
            {% elif result.front_phi_Nsa %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">A<sub>NC</sub>:</span>
        <span class="property-value">{{ result.front_A_NC or '—' }} mm²</span>
    </div>
    <div class="property-item">
        <span class="property-label">A<sub>NCO</sub>:</span>
        <span class="property-value">{{ result.A_NCO or '—' }} mm²</span>
    </div>
    <div class="property-item">
        <span class="property-label">φN<sub>cbg</sub>:</span>        
        <span class="property-value">{{ result.front_phi_Ncbg or '—' }} kN
            {% if result.front_phi_Ncbg and result.front_phi_Ncbg > result.front_N_ug %}<span class="status-icon pass">✓</span>
            {% elif result.front_phi_Ncbg %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">φN<sub>pn</sub>:</span>        
        <span class="property-value">{{ result.front_phi_Npn or '—' }} kN
            {% if result.front_phi_Npn and result.front_phi_Npn > result.front_N_ua %}<span class="status-icon pass">✓</span>
            {% elif result.front_phi_Npn %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">φV<sub>sa</sub>:</span>        
        <span class="property-value">{{ result.front_phi_Vsa or '—' }} kN
            {% if result.front_phi_Vsa and result.front_phi_Vsa > result.front_V_ua %}<span class="status-icon pass">✓</span>
            {% elif result.front_phi_Vsa %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">A<sub>VC</sub>:</span>
        <span class="property-value">{{ result.front_A_VC or '—' }} mm²</span>
    </div>
    <div class="property-item">
        <span class="property-label">A<sub>VCO</sub>:</span>
        <span class="property-value">{{ result.front_A_VCO or '—' }} mm²</span>
    </div>
    <div class="property-item">
        <span class="property-label">φV<sub>cbg</sub>:</span>
        <span class="property-value">{{ result.front_phi_Vcbg or '—' }} kN
            {% if result.front_phi_Vcbg and result.front_phi_Vcbg > result.front_V_ug %}<span class="status-icon pass">✓</span>
            {% elif result.front_phi_Vcbg %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">φV<sub>cp</sub>:</span>
        <span class="property-value">{{ result.front_phi_Vcp or '—' }} kN
            {% if result.front_phi_Vcp and result.front_phi_Vcp > result.front_V_ug %}<span class="status-icon pass">✓</span>
            {% elif result.front_phi_Vcp %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">Interaction:</span>
        <span class="property-value">{{ result.front_interaction or '—' }}
            {% if result.front_beta_N < 0.2 or result.front_beta_V < 0.2 %}
                {% if result.front_interaction and result.front_interaction < 1.0 %}<span class="status-icon pass">✓</span>
                {% elif result.front_interaction %}<span class="status-icon fail">✕</span>
                {% endif %}
            {% else %}
                {% if result.front_interaction and result.front_interaction < 1.2 %}<span class="status-icon pass">✓</span>
                {% elif result.front_interaction %}<span class="status-icon fail">✕</span>
                {% endif %}
            {% endif %}
        </span>
    </div>

    <div class="property-break">Through bolt</div>
    <div class="property-item">
        <span class="property-label">V<sub>u</sub>:</span>
        <span class="property-value">{{ result.bolt_Vu or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">φR<sub>n</sub> (Shear):</span>
        <span class="property-value">{{ result.bolt_phi_Rn_shear or '—' }} kN
            {% if result.bolt_phi_Rn_shear and result.bolt_phi_Rn_shear > result.bolt_Vu %}<span class="status-icon pass">✓</span>
            {% elif result.bolt_phi_Rn_shear %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">φR<sub>n</sub> (Bearing):</span>
        <span class="property-value">{{ result.bolt_phi_Rn_bear or '—' }} kN
            {% if result.bolt_phi_Rn_bear and result.bolt_phi_Rn_bear > result.bolt_Vu %}<span class="status-icon pass">✓</span>
            {% elif result.bolt_phi_Rn_bear %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>

    <div class="property-break">Fin plate</div>
    <div class="property-item">
        <span class="property-label">V<sub>u</sub>:</span>
        <span class="property-value">{{ result.fin_Vu or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">t<sub>req</sub>:</span>
        <span class="property-value">{{ result.fin_t_req or '—' }} mm
            {% if result.fin_t_req and result.fin_t_req < result.fin_thk %}<span class="status-icon pass">✓</span>
            {% elif result.fin_t_req %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">φR<sub>n</sub> (Shear yield):</span>
        <span class="property-value">{{ result.fin_phi_Rn_yield or '—' }} kN
            {% if result.fin_phi_Rn_yield and result.fin_phi_Rn_yield > result.fin_Vu %}<span class="status-icon pass">✓</span>
            {% elif result.fin_phi_Rn_yield %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">φR<sub>n</sub> (Shear rupture):</span>
        <span class="property-value">{{ result.fin_phi_Rn_rupture or '—' }} kN
            {% if result.fin_phi_Rn_rupture and result.fin_phi_Rn_rupture > result.fin_Vu %}<span class="status-icon pass">✓</span>
            {% elif result.fin_phi_Rn_rupture %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">φR<sub>n</sub> (Block shear):</span>
        <span class="property-value">{{ result.fin_phi_Rn_block or '—' }} kN
            {% if result.fin_phi_Rn_block and result.fin_phi_Rn_block > result.fin_Vu %}<span class="status-icon pass">✓</span>
            {% elif result.fin_phi_Rn_block %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>

    <div class="property-break">Weld</div>
    <div class="property-item">
        <span class="property-label">Tensile f<sub>n</sub>:</span>
        <span class="property-value">{{ result.weld_fn or '—' }} N/mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">Shear f<sub>v</sub>:</span>
        <span class="property-value">{{ result.weld_fv or '—' }} N/mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">Bending f<sub>b</sub>:</span>
        <span class="property-value">{{ result.weld_fb or '—' }} N/mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">Resultant, f<sub>R</sub>:</span>
        <span class="property-value">{{ result.weld_fR or '—' }} N/mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">φR<sub>n</sub>:</span>
        <span class="property-value">{{ result.weld_phi_Rn or '—' }} N/mm
            {% if result.weld_phi_Rn and result.weld_phi_Rn > result.weld_fR %}<span class="status-icon pass">✓</span>
            {% elif result.weld_phi_Rn %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>

    <div class="property-break">Base plate</div>
    <div class="property-item">
        <span class="property-label">Top Length:</span>
        <span class="property-value">{{ result.top_bp_length or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">Top Width:</span>
        <span class="property-value">{{ result.top_bp_width or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">Front Length:</span>
        <span class="property-value">{{ result.front_bp_length or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">Front Width:</span>
        <span class="property-value">{{ result.front_bp_width or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">P<sub>u</sub>:</span>
        <span class="property-value">{{ result.bp_Pu or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">d:</span>
        <span class="property-value">{{ result.bp_d or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">b:</span>
        <span class="property-value">{{ result.bp_b or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">m:</span>
        <span class="property-value">{{ result.bp_m or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">n:</span>
        <span class="property-value">{{ result.bp_n or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">t<sub>req</sub> (Bearing):</span>
        <span class="property-value">{{ result.bp_t_req_bear or '—' }} mm
            {% if result.bp_t_req_bear and result.bp_t_req_bear < result.bp_thk %}<span class="status-icon pass">✓</span>
            {% elif result.bp_t_req_bear %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
    <div class="property-item">
        <span class="property-label">T<sub>u</sub>:</span>
        <span class="property-value">{{ result.bp_Tu or '—' }} kN</span>
    </div>
    <div class="property-item">
        <span class="property-label">x:</span>
        <span class="property-value">{{ result.bp_x or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">B<sub>eff</sub>:</span>
        <span class="property-value">{{ result.bp_Beff or '—' }} mm</span>
    </div>
    <div class="property-item">
        <span class="property-label">t<sub>req</sub> (Tension):</span>
        <span class="property-value">{{ result.bp_t_req_tension or '—' }} mm
            {% if result.bp_t_req_tension and result.bp_t_req_tension < result.bp_thk %}<span class="status-icon pass">✓</span>
            {% elif result.bp_t_req_tension %}<span class="status-icon fail">✕</span>
            {% endif %}
        </span>
    </div>
{% endif %}
</div>
{% endmacro %}

{# Wind Preview #}
{% macro wind_table(headers, rows) %}
<table class="mini-table">
    <thead>
        <tr>
            {% for h in headers %}<th>{{ h.label|safe }}</th>{% endfor %}
        </tr>
    </thead>
    <tbody>
        {% if rows and rows|length > 0 %}
            {% for row in rows %}
            <tr>
                {% for h in headers %}
                    <td>{{ row.get(h.key, '') }}</td>
                {% endfor %}
            </tr>
            {% endfor %}
        {% else %}
            <tr><td colspan="{{ headers|length }}" class="wind-empty">No data</td></tr>
        {% endif %}
    </tbody>
</table>
{% endmacro %}

{% macro wind_preview(summary, mwfrs_rows, wall_rows_fmt, roof_rows_fmt) %}
{% set mwfrs_headers = [
    {"key": "Lvl", "label": "Lvl"},
    {"key": "z", "label": "Cumu. (m)"},
    {"key": "Kz", "label": "K<sub>z</sub>"},
    {"key": "Kzt", "label": "K<sub>zt</sub>"},
    {"key": "qz", "label": "q<sub>z</sub> (kPa)"},
    {"key": "P_wind", "label": "P<sub>z</sub> (kPa)"}
] %}

{% set cnc_headers_wall = [
    {"key": "A_eff", "label": "A<sub>eff</sub> (m²)"},
    {"key": "P_z4_pos", "label": "P<sub>z4+</sub> (kPa)"},
    {"key": "P_z4_neg", "label": "P<sub>z4−</sub> (kPa)"},
    {"key": "P_z5_pos", "label": "P<sub>z5+</sub> (kPa)"},
    {"key": "P_z5_neg", "label": "P<sub>z5−</sub> (kPa)"}
] %}

{% set cnc_headers_roof = [
    {"key": "A_eff", "label": "A<sub>eff</sub> (m²)"},
    {"key": "P_z1_neg", "label": "P<sub>z1−</sub> (kPa)"},
    {"key": "P_z2_neg", "label": "P<sub>z2−</sub> (kPa)"},
    {"key": "P_z3_neg", "label": "P<sub>z3−</sub> (kPa)"}
] %}

<div class="wind-result-summary">
    <h4>At height h,</h4>
    <ul>
        <li><span class="label">Importance Factor:</span><span class="value">{{ summary.Imp_factor }}</span></li>
        <li><span class="label">Leeward Ext. Coeffi:</span><span class="value">{{ summary.C_pl }}</span></li>
        <li><span class="label">Gust Factor:</span><span class="value">{{ summary.gust_factor }}</span></li>
        <li><span class="label">Int. Pressure:</span><span class="value">{{ summary.P_hi }} kPa</span></li>
        <li><span class="label">Leeward Pressure:</span><span class="value">{{ summary.P_hl }} kPa</span></li>
        <li><span class="label">Sidewall Pressure:</span><span class="value">{{ summary.P_hs }} kPa</span></li>
    </ul>
</div>

<div class="wind-result">
    <h4>MWFRS Pressures at height z</h4>
    {{ wind_table(mwfrs_headers, mwfrs_rows) }}
</div>

<div class="wind-result">
    <h4>C&amp;C Pressure for Walls at height h</h4>
    {{ wind_table(cnc_headers_wall, wall_rows_fmt) }}
</div>

<div class="wind-result">
    <h4>C&amp;C Pressure for Roof at height h</h4>
    {{ wind_table(cnc_headers_roof, roof_rows_fmt) }}
</div>
{% endmacro %}
